# Migration `20200917163133`

This migration has been generated by Iddan Aaronsohn at 9/17/2020, 7:31:33 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."EnumEntityAction" AS ENUM ('View', 'Create', 'Update', 'Delete', 'Search')

CREATE TYPE "public"."EnumEntityPermissionType" AS ENUM ('AllRoles', 'Granular', 'Disabled')

CREATE TYPE "public"."EnumDataType" AS ENUM ('SingleLineText', 'MultiLineText', 'Email', 'AutoNumber', 'WholeNumber', 'DateTime', 'DecimalNumber', 'Lookup', 'MultiSelectOptionSet', 'OptionSet', 'Boolean', 'GeographicAddress', 'Id', 'CreatedAt', 'UpdatedAt')

CREATE TYPE "public"."EnumBlockType" AS ENUM ('AppSettings', 'Flow', 'ConnectorRestApi', 'ConnectorRestApiCall', 'ConnectorSoapApi', 'ConnectorFile', 'EntityApi', 'EntityApiEndpoint', 'FlowApi', 'Layout', 'CanvasPage', 'EntityPage', 'Document')

CREATE TYPE "public"."ActionStepStatus" AS ENUM ('Waiting', 'Running', 'Failed', 'Success')

CREATE TYPE "public"."EnumLogLevel" AS ENUM ('Error', 'Warning', 'Info', 'Debug')

CREATE TYPE "public"."EnumBuildStatus" AS ENUM ('Completed', 'Waiting', 'Active', 'Delayed', 'Failed', 'Paused')

CREATE TABLE "public"."Account" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"email" text   NOT NULL ,
"firstName" text   NOT NULL ,
"lastName" text   NOT NULL ,
"password" text   NOT NULL ,
"currentUserId" text   ,
"githubId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Organization" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"name" text   NOT NULL ,
"defaultTimeZone" text   NOT NULL ,
"address" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"accountId" text   NOT NULL ,
"organizationId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserRole" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"userId" text   NOT NULL ,
"role" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."App" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"organizationId" text   NOT NULL ,
"name" text   NOT NULL ,
"description" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."AppRole" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"appId" text   NOT NULL ,
"name" text   NOT NULL ,
"displayName" text   NOT NULL ,
"description" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Commit" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"appId" text   NOT NULL ,
"userId" text   NOT NULL ,
"message" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Entity" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"appId" text   NOT NULL ,
"name" text   NOT NULL ,
"displayName" text   NOT NULL ,
"pluralDisplayName" text   NOT NULL ,
"description" text   ,
"lockedByUserId" text   ,
"lockedAt" timestamp(3)   ,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntityVersion" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"entityId" text   NOT NULL ,
"versionNumber" integer   NOT NULL ,
"name" text   NOT NULL ,
"displayName" text   NOT NULL ,
"pluralDisplayName" text   NOT NULL ,
"description" text   ,
"commitId" text   ,
"deleted" boolean   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntityPermission" (
"id" text   NOT NULL ,
"entityVersionId" text   NOT NULL ,
"action" "EnumEntityAction"  NOT NULL ,
"type" "EnumEntityPermissionType"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntityPermissionRole" (
"id" text   NOT NULL ,
"entityVersionId" text   NOT NULL ,
"action" "EnumEntityAction"  NOT NULL ,
"appRoleId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntityPermissionField" (
"id" text   NOT NULL ,
"permissionId" text   NOT NULL ,
"fieldPermanentId" text   NOT NULL ,
"entityVersionId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."EntityField" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"entityVersionId" text   NOT NULL ,
"permanentId" text   NOT NULL ,
"name" text   NOT NULL ,
"displayName" text   NOT NULL ,
"dataType" "EnumDataType"  NOT NULL ,
"properties" jsonb   NOT NULL ,
"required" boolean   NOT NULL ,
"searchable" boolean   NOT NULL ,
"description" text   NOT NULL ,
"position" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Block" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"appId" text   NOT NULL ,
"parentBlockId" text   ,
"blockType" "EnumBlockType"  NOT NULL ,
"displayName" text   NOT NULL ,
"description" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BlockVersion" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"blockId" text   NOT NULL ,
"versionNumber" integer   NOT NULL ,
"label" text   NOT NULL ,
"inputParameters" jsonb   ,
"outputParameters" jsonb   ,
"settings" jsonb   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Action" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ActionStep" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"message" text   NOT NULL ,
"status" "ActionStepStatus"  NOT NULL ,
"completedAt" timestamp(3)   ,
"actionId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ActionLog" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"message" text   NOT NULL ,
"meta" jsonb   NOT NULL ,
"level" "EnumLogLevel"  NOT NULL ,
"stepId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Build" (
"id" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"appId" text   NOT NULL ,
"userId" text   NOT NULL ,
"status" "EnumBuildStatus"  NOT NULL ,
"version" text   NOT NULL ,
"message" text   ,
"actionId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_BuildToEntityVersion" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_EntityPermissionFieldToEntityPermissionRole" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_BlockVersionToBuild" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "Account.email_unique" ON "public"."Account"("email")

CREATE UNIQUE INDEX "Account_currentUserId_unique" ON "public"."Account"("currentUserId")

CREATE UNIQUE INDEX "Organization.name_unique" ON "public"."Organization"("name")

CREATE UNIQUE INDEX "User.accountId_organizationId_unique" ON "public"."User"("accountId", "organizationId")

CREATE UNIQUE INDEX "UserRole.userId_role_unique" ON "public"."UserRole"("userId", "role")

CREATE UNIQUE INDEX "App.organizationId_name_unique" ON "public"."App"("organizationId", "name")

CREATE UNIQUE INDEX "AppRole.appId_name_unique" ON "public"."AppRole"("appId", "name")

CREATE UNIQUE INDEX "AppRole.appId_displayName_unique" ON "public"."AppRole"("appId", "displayName")

CREATE UNIQUE INDEX "Entity.appId_name_unique" ON "public"."Entity"("appId", "name")

CREATE UNIQUE INDEX "Entity.appId_pluralDisplayName_unique" ON "public"."Entity"("appId", "pluralDisplayName")

CREATE UNIQUE INDEX "Entity.appId_displayName_unique" ON "public"."Entity"("appId", "displayName")

CREATE UNIQUE INDEX "EntityVersion.entityId_versionNumber_unique" ON "public"."EntityVersion"("entityId", "versionNumber")

CREATE UNIQUE INDEX "EntityPermission.entityVersionId_action_unique" ON "public"."EntityPermission"("entityVersionId", "action")

CREATE UNIQUE INDEX "EntityPermissionRole.entityVersionId_action_appRoleId_unique" ON "public"."EntityPermissionRole"("entityVersionId", "action", "appRoleId")

CREATE UNIQUE INDEX "EntityPermissionField.permissionId_fieldPermanentId_unique" ON "public"."EntityPermissionField"("permissionId", "fieldPermanentId")

CREATE UNIQUE INDEX "EntityField.entityVersionId_permanentId_unique" ON "public"."EntityField"("entityVersionId", "permanentId")

CREATE UNIQUE INDEX "EntityField.entityVersionId_name_unique" ON "public"."EntityField"("entityVersionId", "name")

CREATE UNIQUE INDEX "EntityField.entityVersionId_displayName_unique" ON "public"."EntityField"("entityVersionId", "displayName")

CREATE UNIQUE INDEX "Block.appId_displayName_unique" ON "public"."Block"("appId", "displayName")

CREATE UNIQUE INDEX "BlockVersion.blockId_versionNumber_unique" ON "public"."BlockVersion"("blockId", "versionNumber")

CREATE UNIQUE INDEX "Build.appId_version_unique" ON "public"."Build"("appId", "version")

CREATE UNIQUE INDEX "_BuildToEntityVersion_AB_unique" ON "public"."_BuildToEntityVersion"("A", "B")

CREATE INDEX "_BuildToEntityVersion_B_index" ON "public"."_BuildToEntityVersion"("B")

CREATE UNIQUE INDEX "_EntityPermissionFieldToEntityPermissionRole_AB_unique" ON "public"."_EntityPermissionFieldToEntityPermissionRole"("A", "B")

CREATE INDEX "_EntityPermissionFieldToEntityPermissionRole_B_index" ON "public"."_EntityPermissionFieldToEntityPermissionRole"("B")

CREATE UNIQUE INDEX "_BlockVersionToBuild_AB_unique" ON "public"."_BlockVersionToBuild"("A", "B")

CREATE INDEX "_BlockVersionToBuild_B_index" ON "public"."_BlockVersionToBuild"("B")

ALTER TABLE "public"."Account" ADD FOREIGN KEY ("currentUserId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("accountId")REFERENCES "public"."Account"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("organizationId")REFERENCES "public"."Organization"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserRole" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."App" ADD FOREIGN KEY ("organizationId")REFERENCES "public"."Organization"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."AppRole" ADD FOREIGN KEY ("appId")REFERENCES "public"."App"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Commit" ADD FOREIGN KEY ("appId")REFERENCES "public"."App"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Commit" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Entity" ADD FOREIGN KEY ("appId")REFERENCES "public"."App"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Entity" ADD FOREIGN KEY ("lockedByUserId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."EntityVersion" ADD FOREIGN KEY ("entityId")REFERENCES "public"."Entity"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityVersion" ADD FOREIGN KEY ("commitId")REFERENCES "public"."Commit"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."EntityPermission" ADD FOREIGN KEY ("entityVersionId")REFERENCES "public"."EntityVersion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityPermissionRole" ADD FOREIGN KEY ("entityVersionId", "action")REFERENCES "public"."EntityPermission"("entityVersionId","action") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityPermissionRole" ADD FOREIGN KEY ("appRoleId")REFERENCES "public"."AppRole"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityPermissionField" ADD FOREIGN KEY ("permissionId")REFERENCES "public"."EntityPermission"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityPermissionField" ADD FOREIGN KEY ("fieldPermanentId", "entityVersionId")REFERENCES "public"."EntityField"("permanentId","entityVersionId") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityField" ADD FOREIGN KEY ("entityVersionId")REFERENCES "public"."EntityVersion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Block" ADD FOREIGN KEY ("appId")REFERENCES "public"."App"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Block" ADD FOREIGN KEY ("parentBlockId")REFERENCES "public"."Block"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."BlockVersion" ADD FOREIGN KEY ("blockId")REFERENCES "public"."Block"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ActionStep" ADD FOREIGN KEY ("actionId")REFERENCES "public"."Action"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ActionLog" ADD FOREIGN KEY ("stepId")REFERENCES "public"."ActionStep"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Build" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Build" ADD FOREIGN KEY ("appId")REFERENCES "public"."App"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Build" ADD FOREIGN KEY ("actionId")REFERENCES "public"."Action"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BuildToEntityVersion" ADD FOREIGN KEY ("A")REFERENCES "public"."Build"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BuildToEntityVersion" ADD FOREIGN KEY ("B")REFERENCES "public"."EntityVersion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EntityPermissionFieldToEntityPermissionRole" ADD FOREIGN KEY ("A")REFERENCES "public"."EntityPermissionField"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_EntityPermissionFieldToEntityPermissionRole" ADD FOREIGN KEY ("B")REFERENCES "public"."EntityPermissionRole"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BlockVersionToBuild" ADD FOREIGN KEY ("A")REFERENCES "public"."BlockVersion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BlockVersionToBuild" ADD FOREIGN KEY ("B")REFERENCES "public"."Build"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200917163133
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,364 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider        = "prisma-client-js"
+  previewFeatures = ["insensitiveFilters"]
+
+}
+
+// generator typegraphql {
+//   provider = "node ./node_modules/typegraphql-prisma/generator.js"
+//   output   = "./dal"
+// }
+
+model Account {
+  id            String   @default(cuid()) @id
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  email         String   @unique
+  firstName     String
+  lastName      String
+  password      String
+  users         User[]   @relation("AccountOnUser")
+  currentUser   User?    @relation(fields: [currentUserId], references: [id])
+  currentUserId String?
+  githubId      String?
+}
+
+model Organization {
+  id              String   @default(cuid()) @id
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+  name            String   @unique
+  defaultTimeZone String
+  address         String
+  apps            App[]
+  users           User[]
+}
+
+model User {
+  id                String       @default(cuid()) @id
+  createdAt         DateTime     @default(now())
+  updatedAt         DateTime     @updatedAt
+  account           Account      @relation("AccountOnUser", fields: [accountId], references: [id])
+  accountId         String
+  organization      Organization @relation(fields: [organizationId], references: [id])
+  organizationId    String
+  userRoles         UserRole[]
+  assignedCurrentTo Account?
+
+  @@unique([accountId, organizationId])
+  commits       Commit[]
+  lockedEntitis Entity[]
+  builds        Build[]
+}
+
+model UserRole {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  user      User     @relation(fields: [userId], references: [id])
+  userId    String
+  role      String
+
+  @@unique([userId, role])
+}
+
+model App {
+  id             String       @default(cuid()) @id
+  createdAt      DateTime     @default(now())
+  updatedAt      DateTime     @updatedAt
+  organization   Organization @relation(fields: [organizationId], references: [id])
+  organizationId String
+  name           String
+  description    String
+  entities       Entity[]
+  blocks         Block[]
+  roles          AppRole[]
+  commits        Commit[]
+  builds         Build[]
+
+  @@unique([organizationId, name])
+}
+
+model AppRole {
+  id          String   @default(cuid()) @id
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  app         App      @relation(fields: [appId], references: [id])
+  appId       String
+  name        String
+  displayName String
+  description String?
+
+  @@unique([appId, name])
+  @@unique([appId, displayName])
+  entityPermissionRoles EntityPermissionRole[]
+}
+
+model Commit {
+  id        String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  app       App      @relation(fields: [appId], references: [id])
+  appId     String
+  user      User     @relation(fields: [userId], references: [id])
+  userId    String
+  message   String
+
+  entityVersions EntityVersion[]
+}
+
+model Entity {
+  id                String          @default(cuid()) @id
+  createdAt         DateTime        @default(now())
+  updatedAt         DateTime        @updatedAt
+  app               App             @relation(fields: [appId], references: [id])
+  appId             String
+  name              String
+  displayName       String
+  pluralDisplayName String
+  description       String?
+  versions          EntityVersion[]
+  lockedByUser      User?           @relation(fields: [lockedByUserId], references: [id])
+  lockedByUserId    String?
+  lockedAt          DateTime?
+  deletedAt         DateTime?
+
+  @@unique([appId, name])
+  @@unique([appId, pluralDisplayName])
+  @@unique([appId, displayName])
+}
+
+model EntityVersion {
+  id                String             @default(cuid()) @id
+  createdAt         DateTime           @default(now())
+  updatedAt         DateTime           @updatedAt
+  entity            Entity             @relation(fields: [entityId], references: [id])
+  entityId          String
+  versionNumber     Int
+  name              String
+  displayName       String
+  pluralDisplayName String
+  description       String?
+  fields            EntityField[]
+  commit            Commit?            @relation(fields: [commitId], references: [id])
+  commitId          String?
+  permissions       EntityPermission[]
+  builds            Build[]            @relation(references: [id])
+  deleted           Boolean?
+
+  @@unique([entityId, versionNumber])
+
+}
+
+enum EnumEntityAction {
+  View
+  Create
+  Update
+  Delete
+  Search
+}
+
+enum EnumEntityPermissionType {
+  AllRoles
+  Granular
+  Disabled
+}
+
+model EntityPermission {
+  id               String                   @default(cuid()) @id
+  entityVersion    EntityVersion            @relation(fields: [entityVersionId], references: [id])
+  entityVersionId  String
+  action           EnumEntityAction
+  type             EnumEntityPermissionType
+  permissionRoles  EntityPermissionRole[]
+  permissionFields EntityPermissionField[]
+  @@unique([entityVersionId, action])
+}
+
+model EntityPermissionRole {
+  id               String                  @default(cuid()) @id
+  permission       EntityPermission        @relation(fields: [entityVersionId, action], references: [entityVersionId, action])
+  entityVersionId  String
+  action           EnumEntityAction
+  appRole          AppRole                 @relation(fields: [appRoleId], references: [id])
+  appRoleId        String
+  permissionFields EntityPermissionField[]
+  @@unique([entityVersionId, action, appRoleId])
+
+}
+
+model EntityPermissionField {
+  id               String                 @default(cuid()) @id
+  permission       EntityPermission       @relation(fields: [permissionId], references: [id])
+  permissionId     String
+  field            EntityField            @relation(fields: [fieldPermanentId, entityVersionId], references: [permanentId, entityVersionId])
+  fieldPermanentId String
+  entityVersionId  String
+  permissionRoles  EntityPermissionRole[]
+
+  @@unique([permissionId, fieldPermanentId])
+}
+
+model EntityField {
+  id              String        @default(cuid()) @id
+  createdAt       DateTime      @default(now())
+  updatedAt       DateTime      @updatedAt
+  entityVersion   EntityVersion @relation(fields: [entityVersionId], references: [id])
+  entityVersionId String
+  permanentId     String        @default(cuid())
+  name            String
+  displayName     String
+  dataType        EnumDataType
+  properties      Json
+  required        Boolean
+  // TBD
+  searchable      Boolean
+  description     String
+  position        Int?
+
+  @@unique([entityVersionId, permanentId])
+  @@unique([entityVersionId, name])
+  @@unique([entityVersionId, displayName])
+  permissionField EntityPermissionField[]
+}
+
+enum EnumDataType {
+  SingleLineText
+  MultiLineText
+  Email
+  AutoNumber
+  WholeNumber
+  DateTime
+  DecimalNumber
+  Lookup
+  MultiSelectOptionSet
+  OptionSet
+  Boolean
+  GeographicAddress
+  Id
+  CreatedAt
+  UpdatedAt
+}
+
+model Block {
+  id            String         @default(cuid()) @id
+  createdAt     DateTime       @default(now())
+  updatedAt     DateTime       @updatedAt
+  app           App            @relation(fields: [appId], references: [id])
+  appId         String
+  parentBlock   Block?         @relation(fields: [parentBlockId], references: [id])
+  parentBlockId String?
+  blockType     EnumBlockType
+  displayName   String
+  description   String?
+  versions      BlockVersion[]
+
+  @@unique([appId, displayName])
+  blocks Block[] @relation("BlockToBlock")
+}
+
+enum EnumBlockType {
+  AppSettings
+  Flow
+  ConnectorRestApi
+  ConnectorRestApiCall
+  ConnectorSoapApi
+  ConnectorFile
+  EntityApi
+  EntityApiEndpoint
+  FlowApi
+  Layout
+  CanvasPage
+  EntityPage
+  Document
+}
+
+model BlockVersion {
+  id               String   @default(cuid()) @id
+  createdAt        DateTime @default(now())
+  updatedAt        DateTime @updatedAt
+  block            Block    @relation(fields: [blockId], references: [id])
+  blockId          String
+  versionNumber    Int
+  label            String
+  inputParameters  Json? //JSON
+  outputParameters Json? //JSON
+  settings         Json //JSON
+  builds           Build[]  @relation(references: [id])
+
+  @@unique([blockId, versionNumber])
+}
+
+enum ActionStepStatus {
+  Waiting
+  Running
+  Failed
+  Success
+}
+
+model Action {
+  id        String       @default(cuid()) @id
+  createdAt DateTime     @default(now())
+  steps     ActionStep[]
+  builds    Build[]
+}
+
+model ActionStep {
+  id          String           @default(cuid()) @id
+  createdAt   DateTime         @default(now())
+  message     String
+  status      ActionStepStatus
+  completedAt DateTime?
+  logs        ActionLog[]
+  action      Action           @relation(fields: [actionId], references: [id])
+  actionId    String
+}
+
+enum EnumLogLevel {
+  Error
+  Warning
+  Info
+  Debug
+}
+
+model ActionLog {
+  id        String       @default(cuid()) @id
+  createdAt DateTime     @default(now())
+  message   String
+  meta      Json
+  level     EnumLogLevel
+  step      ActionStep   @relation(fields: [stepId], references: [id])
+  stepId    String
+}
+
+enum EnumBuildStatus {
+  Completed
+  Waiting
+  Active
+  Delayed
+  Failed
+  Paused
+}
+
+model Build {
+  id             String          @default(cuid()) @id
+  createdAt      DateTime        @default(now())
+  createdBy      User            @relation(fields: [userId], references: [id])
+  app            App             @relation(fields: [appId], references: [id])
+  appId          String
+  userId         String
+  status         EnumBuildStatus
+  blockVersions  BlockVersion[]  @relation(references: [id])
+  entityVersions EntityVersion[] @relation(references: [id])
+  version        String
+  message        String?
+  action         Action          @relation(fields: [actionId], references: [id])
+  actionId       String
+
+
+  @@unique([appId, version])
+}
```


