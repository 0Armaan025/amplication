# Migration `20200819134733`

This migration has been generated by Yuval Hazaz at 8/19/2020, 4:47:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "EnumEntityFieldAction" AS ENUM ('View', 'Update', 'Search');

CREATE TABLE "public"."EntityFieldPermission" (
"entityFieldId" text  NOT NULL ,
"action" "EnumEntityFieldAction" NOT NULL ,
"appRoleId" text  NOT NULL ,
PRIMARY KEY ("entityFieldId","action","appRoleId"))

ALTER TABLE "public"."EntityFieldPermission" ADD FOREIGN KEY ("entityFieldId")REFERENCES "public"."EntityField"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."EntityFieldPermission" ADD FOREIGN KEY ("appRoleId")REFERENCES "public"."AppRole"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200816170930..20200819134733
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider        = "prisma-client-js"
@@ -89,20 +89,22 @@
   @@unique([organizationId, name])
 }
 model AppRole {
-  id          String   @default(cuid()) @id
-  createdAt   DateTime @default(now())
-  updatedAt   DateTime @updatedAt
-  app         App      @relation(fields: [appId], references: [id])
-  appId       String
-  name        String
-  displayName String
-  description String?
+  id                     String                  @default(cuid()) @id
+  createdAt              DateTime                @default(now())
+  updatedAt              DateTime                @updatedAt
+  app                    App                     @relation(fields: [appId], references: [id])
+  appId                  String
+  name                   String
+  displayName            String
+  description            String?
+  entityPermissions      EntityPermission[]
+  entityFieldPermissions EntityFieldPermission[]
   @@unique([appId, name])
   @@unique([appId, displayName])
-  entityPermissions EntityPermission[]
+
 }
 model Commit {
   id        String   @default(cuid()) @id
@@ -176,22 +178,23 @@
   @@id([entityVersionId, action, appRoleId])
 }
 model EntityField {
-  id               String        @default(cuid()) @id
-  createdAt        DateTime      @default(now())
-  updatedAt        DateTime      @updatedAt
-  entityVersion    EntityVersion @relation(fields: [entityVersionId], references: [id])
-  entityVersionId  String
-  fieldPermanentId String        @default(cuid())
-  name             String
-  displayName      String
-  dataType         EnumDataType
-  properties       Json
-  required         Boolean
+  id                     String                  @default(cuid()) @id
+  createdAt              DateTime                @default(now())
+  updatedAt              DateTime                @updatedAt
+  entityVersion          EntityVersion           @relation(fields: [entityVersionId], references: [id])
+  entityVersionId        String
+  fieldPermanentId       String                  @default(cuid())
+  name                   String
+  displayName            String
+  dataType               EnumDataType
+  properties             Json
+  required               Boolean
   // TBD
-  searchable       Boolean
-  description      String
+  searchable             Boolean
+  description            String
+  entityFieldPermissions EntityFieldPermission[]
   @@unique([entityVersionId, name])
   @@unique([entityVersionId, displayName])
 }
@@ -217,8 +220,25 @@
   CreatedAt
   UpdatedAt
 }
+enum EnumEntityFieldAction {
+  View
+  Update
+  Search
+}
+
+model EntityFieldPermission {
+  entityField   EntityField           @relation(fields: [entityFieldId], references: [id])
+  entityFieldId String
+  action        EnumEntityFieldAction
+  appRole       AppRole               @relation(fields: [appRoleId], references: [id])
+  appRoleId     String
+
+
+  @@id([entityFieldId, action, appRoleId])
+}
+
 model Block {
   id            String         @default(cuid()) @id
   createdAt     DateTime       @default(now())
   updatedAt     DateTime       @updatedAt
```


