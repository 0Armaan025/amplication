# Migration `20200323133235`

This migration has been generated by Yuval Hazaz at 3/23/2020, 1:32:35 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."EntityVersion" (
    "Label" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "entity" text  NOT NULL ,
    "id" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "versionNumber" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Entity" DROP CONSTRAINT IF EXiSTS "Entity_projects_fkey",
DROP COLUMN "projects",
ADD COLUMN "project" text  NOT NULL ;

ALTER TABLE "public"."EntityField" DROP CONSTRAINT IF EXiSTS "EntityField_entity_fkey",
DROP COLUMN "entity",
ADD COLUMN "entityVersion" text  NOT NULL ;

ALTER TABLE "public"."EntityVersion" ADD FOREIGN KEY ("entity")REFERENCES "public"."Entity"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Entity" ADD FOREIGN KEY ("project")REFERENCES "public"."Project"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."EntityField" ADD FOREIGN KEY ("entityVersion")REFERENCES "public"."EntityVersion"("id") ON DELETE RESTRICT  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200323133235
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,149 @@
+datasource sqlite {
+  provider = "sqlite"
+  url      = "file:./dev.db"
+  enabled  = false
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRESQL_URL")
+  enabled  = true
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+generator typegraphql {
+  provider = "node_modules/typegraphql-prisma-nestjs/generator.js"
+  output   = "./dal"
+}
+
+model Account {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  email String @unique
+  firstName String
+  lastName String
+  password  String
+  users  User[]
+}
+
+
+
+
+model Organization {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name  String
+  defaultTimeZone String
+  address String
+  projects  Project[]
+  users User[]
+}
+
+
+
+model User {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  account Account
+  organization Organization
+  userRoles UserRole[]
+}
+
+
+// enum Role {
+//   ADMIN
+//   USER
+//   ORGANIZATION_ADMIN
+//   PROJECT_ADMIN
+
+// }
+
+model UserRole {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  user  User
+  role String
+}
+
+
+
+model Project {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  organization Organization
+  name  String 
+  entity  Entity[] 
+  //@@index([organization])
+}
+
+model Entity {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  project  Project
+  name  String
+  displayName String
+  pluralDisplayName String
+  description String
+  isPersistent  Boolean
+  allowFeedback Boolean // TBC
+  primaryField  String
+}
+
+
+model EntityVersion {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  entity Entity
+  versionNumber Int 
+  Label String
+}
+
+
+
+
+model EntityField {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  entityVersion EntityVersion
+  name  String
+  displayName String
+  dataType  EnumDataType
+  dataTypeProperties  String // JSON representation of the properties that relates based on selected type of field
+  properties  String
+  required  Boolean // TBD
+  searchable  Boolean // TBD
+  description String // TBD
+}
+
+enum EnumDataType {
+  Text
+  AutoNumber
+  WholeNumber
+  TimeZone
+  Language
+  DateAndTime
+  Currancy
+  DecimalNumber
+  File
+  Image
+  Lookup
+  CustomEntity
+  OptionSet
+  Boolean
+  Color
+  Guid
+  Time
+  CalculatedField
+  RollupField
+}
```


