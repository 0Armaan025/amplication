# Migration `20200601143545`

This migration has been generated by Yuval Hazaz at 6/1/2020, 2:35:45 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "EnumBlockType_new" AS ENUM ('appSettings', 'flow', 'ConnectorRestApi', 'ConnectorRestApiCall', 'ConnectorSoapApi', 'ConnectorFile', 'entityApi', 'entityApiEndpoint', 'flowApi', 'layout', 'canvasPage', 'wizardPage', 'document');
ALTER TABLE "public"."Block" ALTER COLUMN "blockType" DROP DEFAULT,
                        ALTER COLUMN "blockType" TYPE "EnumBlockType_new" USING ("blockType"::text::"EnumBlockType_new"),
                        ALTER COLUMN "blockType" SET DEFAULT 'appSettings';
ALTER TYPE "EnumBlockType" RENAME TO "EnumBlockType_old";
ALTER TYPE "EnumBlockType_new" RENAME TO "EnumBlockType";
DROP TYPE "EnumBlockType_old"

ALTER TABLE "public"."BlockVersion" DROP COLUMN "Configuration",
ADD COLUMN "configuration" text  NOT NULL ;

ALTER TABLE "public"."EntityVersion" DROP CONSTRAINT IF EXiSTS "EntityVersion_blockId_fkey",
DROP COLUMN "blockId";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200531114204-blocks..20200601143545
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRESQL_URL")
   enabled  = true
 }
 generator client {
@@ -111,12 +111,11 @@
   entityId      String
   versionNumber Int
   label         String
   entityFields  EntityField[]
-  Block         Block?        @relation(fields: [blockId], references: [id])
-  blockId       String?
   @@unique([entityId, versionNumber])
+
 }
 model EntityField {
   id               String        @default(cuid()) @id
@@ -158,29 +157,31 @@
   geographicAddress
 }
 model Block {
-  id            String          @default(cuid()) @id
-  createdAt     DateTime        @default(now())
-  updatedAt     DateTime        @updatedAt
-  app           App             @relation(fields: [appId], references: [id])
+  id            String         @default(cuid()) @id
+  createdAt     DateTime       @default(now())
+  updatedAt     DateTime       @updatedAt
+  app           App            @relation(fields: [appId], references: [id])
   appId         String
   blockType     EnumBlockType
   name          String
   description   String?
-  BlockVersions EntityVersion[]
-  BlockVersion  BlockVersion[]
+  blockVersions BlockVersion[]
   @@unique([appId, name])
 }
 enum EnumBlockType {
   appSettings
   flow
-  connector
-  connectorAPICall
-  aPI
-  aPIEndpoint
+  ConnectorRestApi
+  ConnectorRestApiCall
+  ConnectorSoapApi
+  ConnectorFile
+  entityApi
+  entityApiEndpoint
+  flowApi
   layout
   canvasPage
   wizardPage
   document
@@ -195,8 +196,8 @@
   versionNumber    Int
   label            String
   inputParameters  String
   outputParameters String
-  Configuration    String
+  configuration    String
   @@unique([blockId, versionNumber])
-}
+}
```


