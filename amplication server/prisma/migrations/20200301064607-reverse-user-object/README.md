# Migration `20200301064607-reverse-user-object`

This migration has been generated by Alon Ram at 3/1/2020, 6:46:07 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "EnumRoleLevel" AS ENUM ('Organization', 'Project');

CREATE TABLE "public"."Project" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "defaultTimeZone" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "organization" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Account" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "email" text  NOT NULL DEFAULT '',
    "firstname" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "lastName" text  NOT NULL DEFAULT '',
    "password" text  NOT NULL DEFAULT '',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."AccountUser" (
    "account" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "organization" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."UserRole" (
    "accountUser" text  NOT NULL ,
    "createEntity" boolean  NOT NULL DEFAULT false,
    "createFlow" boolean  NOT NULL DEFAULT false,
    "createUi" boolean  NOT NULL DEFAULT false,
    "createWebServices" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "roleLevel" "EnumRoleLevel" NOT NULL DEFAULT 'Organization',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Entity" DROP CONSTRAINT IF EXiSTS "Entity_environment_fkey",
DROP COLUMN "environment",
ADD COLUMN "projects" text  NOT NULL ;

ALTER TABLE "public"."Project" ADD FOREIGN KEY ("organization")REFERENCES "public"."Organization"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."AccountUser" ADD FOREIGN KEY ("organization")REFERENCES "public"."Organization"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."AccountUser" ADD FOREIGN KEY ("account")REFERENCES "public"."Account"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."UserRole" ADD FOREIGN KEY ("accountUser")REFERENCES "public"."AccountUser"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Entity" ADD FOREIGN KEY ("projects")REFERENCES "public"."Project"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

DROP TABLE "public"."Environment";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200301063034-create-users-and-rols..20200301064607-reverse-user-object
--- datamodel.dml
+++ datamodel.dml
@@ -1,13 +1,13 @@
 datasource sqlite {
   provider = "sqlite"
-  url = "***"
+  url      = "file:./dev.db"
   enabled  = false
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRESQL_URL")
   enabled  = true
 }
 generator client {
@@ -46,12 +46,13 @@
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   name  String
   defaultTimeZone String
-  environments  Environment[]
+  projects  Project[]
+  accountUsers AccountUser[]
 }
-model Environment {
+model Project {
   id    String   @default(cuid()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   organization Organization
@@ -65,9 +66,9 @@
 model Entity {
   id    String   @default(cuid()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  environment Environment
+  projects  Project
   name  String
   displayName String
   pluralDisplayName String
   description String
@@ -113,6 +114,42 @@
   CalculatedField
   RollupField
 }
+model Account {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  email String
+  firstname String
+  lastName String
+  password  String
+  accountUsers  AccountUser[]
+}
+model AccountUser {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  account Account
+  organization Organization
+  userRoles UserRole[]
+}
+
+model UserRole {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  accountUser  AccountUser
+  roleLevel EnumRoleLevel
+  createEntity  Boolean
+  createFlow  Boolean
+  createUi  Boolean
+  createWebServices Boolean
+}
+
+enum EnumRoleLevel {
+  Organization
+  Project
+}
+
```


