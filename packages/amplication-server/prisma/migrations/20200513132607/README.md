# Migration `20200513132607`

This migration has been generated by Yuval Hazaz at 5/13/2020, 1:26:07 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Account" ADD COLUMN "currentUser" text   ;

ALTER TABLE "public"."Entity" DROP COLUMN "project",
ADD COLUMN "app" text  NOT NULL ,
ALTER COLUMN "description" DROP NOT NULL,
ALTER COLUMN "description" DROP DEFAULT,
ALTER COLUMN "primaryField" DROP NOT NULL,
ALTER COLUMN "primaryField" DROP DEFAULT;

ALTER TABLE "public"."EntityField" DROP COLUMN "dataTypeProperties";

CREATE UNIQUE INDEX "Entity.app_name" ON "public"."Entity"("app","name")

CREATE UNIQUE INDEX "Entity.app_pluralDisplayName" ON "public"."Entity"("app","pluralDisplayName")

CREATE UNIQUE INDEX "Entity.app_displayName" ON "public"."Entity"("app","displayName")

ALTER TABLE "public"."Account" ADD FOREIGN KEY ("currentUser")REFERENCES "public"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Entity" ADD FOREIGN KEY ("app")REFERENCES "public"."App"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

DROP TABLE "public"."Project";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200513132607
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,163 @@
+datasource sqlite {
+  provider = "sqlite"
+  url      = "file:./dev.db"
+  enabled  = false
+}
+
+datasource db {
+  provider = "postgresql"
+  url      = env("POSTGRESQL_URL")
+  enabled  = true
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+generator typegraphql {
+  provider = "node_modules/typegraphql-prisma-nestjs/generator.js"
+  output   = "./dal"
+}
+
+model Account {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  email String @unique
+  firstName String
+  lastName String
+  password  String
+  users  User[]
+  currentUser User? @relation("CurrentUser")
+}
+
+
+
+
+model Organization {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name  String //@unique
+  defaultTimeZone String
+  address String
+  apps  App[]
+  users User[]
+}
+
+
+
+model User {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  account Account
+  organization Organization
+  userRoles UserRole[]
+
+   //@@unique([account, organization])
+}
+
+
+// enum Role {
+//   ADMIN
+//   USER
+//   ORGANIZATION_ADMIN
+//   PROJECT_ADMIN
+
+// }
+
+model UserRole {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  user  User
+  role String
+
+   //@@unique([user, role])
+}
+
+
+model App {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  organization Organization
+  name  String 
+  description String
+  entity  Entity[] 
+
+  //@@unique([organization, name])
+}
+
+model Entity {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  app  App
+  name  String
+  displayName String
+  pluralDisplayName String
+  description String?
+  isPersistent  Boolean
+  allowFeedback Boolean // TBC
+  primaryField  String?
+
+  @@unique([app, name])
+  @@unique([app, pluralDisplayName])
+  @@unique([app, displayName])
+}
+
+
+model EntityVersion {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  entity Entity
+  versionNumber Int 
+  Label String
+
+  //@@unique([entity, versionNumber])
+}
+
+
+
+
+model EntityField {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  entityVersion EntityVersion
+  name  String
+  displayName String
+  dataType  EnumDataType
+  properties  String
+  required  Boolean // TBD
+  searchable  Boolean // TBD
+  description String // TBD
+
+  //@@unique([entityVersion, name])
+  //@@unique([entityVersion, displayName])
+}
+
+enum EnumDataType {
+  Text
+  AutoNumber
+  WholeNumber
+  TimeZone
+  Language
+  DateAndTime
+  Currancy
+  DecimalNumber
+  File
+  Image
+  Lookup
+  CustomEntity
+  OptionSet
+  Boolean
+  Color
+  Guid
+  Time
+  CalculatedField
+  RollupField
+}
```


