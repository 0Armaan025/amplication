# Migration `20200301063034-create-users-and-rols`

This migration has been generated by Alon Ram at 3/1/2020, 6:30:35 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "EnumDataType" AS ENUM ('Text', 'AutoNumber', 'WholeNumber', 'TimeZone', 'Language', 'DateAndTime', 'Currancy', 'DecimalNumber', 'File', 'Image', 'Lookup', 'CustomEntity', 'OptionSet', 'Boolean', 'Color', 'Guid', 'Time', 'CalculatedField', 'RollupField');

CREATE TABLE "public"."Organization" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "defaultTimeZone" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Environment" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "defaultTimeZone" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "organization" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Entity" (
    "allowFeedback" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "description" text  NOT NULL DEFAULT '',
    "displayName" text  NOT NULL DEFAULT '',
    "environment" text  NOT NULL ,
    "id" text  NOT NULL ,
    "isPersistent" boolean  NOT NULL DEFAULT false,
    "name" text  NOT NULL DEFAULT '',
    "pluralDisplayName" text  NOT NULL DEFAULT '',
    "primaryField" text  NOT NULL DEFAULT '',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."EntityField" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "dataType" "EnumDataType" NOT NULL DEFAULT 'Text',
    "dataTypeProperties" text  NOT NULL DEFAULT '',
    "description" text  NOT NULL DEFAULT '',
    "displayName" text  NOT NULL DEFAULT '',
    "entity" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "properties" text  NOT NULL DEFAULT '',
    "required" boolean  NOT NULL DEFAULT false,
    "searchable" boolean  NOT NULL DEFAULT false,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."Environment" ADD FOREIGN KEY ("organization")REFERENCES "public"."Organization"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Entity" ADD FOREIGN KEY ("environment")REFERENCES "public"."Environment"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."EntityField" ADD FOREIGN KEY ("entity")REFERENCES "public"."Entity"("id") ON DELETE RESTRICT  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200227035908-n..20200301063034-create-users-and-rols
--- datamodel.dml
+++ datamodel.dml
@@ -1,13 +1,13 @@
 datasource sqlite {
   provider = "sqlite"
-  url = "***"
+  url      = "file:./dev.db"
   enabled  = false
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRESQL_URL")
   enabled  = true
 }
 generator client {
@@ -40,4 +40,79 @@
   ADMIN
   USER
 }
+model Organization {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name  String
+  defaultTimeZone String
+  environments  Environment[]
+}
+
+model Environment {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  organization Organization
+  name  String 
+  defaultTimeZone String
+  entity  Entity[]
+  
+  //@@index([organization])
+}
+
+model Entity {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  environment Environment
+  name  String
+  displayName String
+  pluralDisplayName String
+  description String
+  isPersistent  Boolean
+  allowFeedback Boolean // TBC
+  primaryField  String
+  entityFields  EntityField[]
+}
+
+model EntityField {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  entity Entity
+  name  String
+  displayName String
+  dataType  EnumDataType
+  dataTypeProperties  String // JSON representation of the properties that relates based on selected type of field
+  properties  String
+  required  Boolean // TBD
+  searchable  Boolean // TBD
+  description String // TBD
+}
+
+enum EnumDataType {
+  Text
+  AutoNumber
+  WholeNumber
+  TimeZone
+  Language
+  DateAndTime
+  Currancy
+  DecimalNumber
+  File
+  Image
+  Lookup
+  CustomEntity
+  OptionSet
+  Boolean
+  Color
+  Guid
+  Time
+  CalculatedField
+  RollupField
+}
+
+
+
```


