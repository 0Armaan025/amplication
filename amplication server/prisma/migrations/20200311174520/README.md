# Migration `20200311174520`

This migration has been generated by Yuval Hazaz at 3/11/2020, 5:45:20 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
    "account" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "organization" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

ALTER TABLE "public"."UserRole" DROP CONSTRAINT IF EXiSTS "UserRole_accountUser_fkey",
DROP COLUMN "accountUser",
DROP COLUMN "createEntity",
DROP COLUMN "createFlow",
DROP COLUMN "createUi",
DROP COLUMN "createWebServices",
DROP COLUMN "roleLevel",
ADD COLUMN "role" "Role" NOT NULL DEFAULT 'ADMIN',
ADD COLUMN "user" text  NOT NULL ;

ALTER TABLE "public"."User" ADD FOREIGN KEY ("account")REFERENCES "public"."Account"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("organization")REFERENCES "public"."Organization"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."UserRole" ADD FOREIGN KEY ("user")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

DROP TABLE "public"."AccountUser";

DROP TYPE "EnumRoleLevel"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200311133239..20200311174520
--- datamodel.dml
+++ datamodel.dml
@@ -1,13 +1,13 @@
 datasource sqlite {
   provider = "sqlite"
-  url = "***"
+  url      = "file:./dev.db"
   enabled  = false
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("POSTGRESQL_URL")
   enabled  = true
 }
 generator client {
@@ -26,17 +26,13 @@
   email String @unique
   firstName String
   lastName String
   password  String
-  accountUsers  AccountUser[]
+  users  User[]
 }
-enum Role {
-  ADMIN
-  USER
-}
 model Organization {
   id    String   @default(cuid()) @id
   createdAt DateTime @default(now())
@@ -44,11 +40,38 @@
   name  String
   defaultTimeZone String
   address String
   projects  Project[]
-  accountUsers AccountUser[]
+  users User[]
 }
+
+
+model User {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  account Account
+  organization Organization
+  userRoles UserRole[]
+}
+
+
+enum Role {
+  ADMIN
+  USER
+}
+
+model UserRole {
+  id    String   @default(cuid()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  user  User
+  role Role
+}
+
+
+
 model Project {
   id    String   @default(cuid()) @id
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
@@ -110,31 +133,6 @@
   RollupField
 }
-model AccountUser {
-  id    String   @default(cuid()) @id
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-  account Account
-  organization Organization
-  userRoles UserRole[]
-}
-model UserRole {
-  id    String   @default(cuid()) @id
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
-  accountUser  AccountUser
-  roleLevel EnumRoleLevel
-  createEntity  Boolean
-  createFlow  Boolean
-  createUi  Boolean
-  createWebServices Boolean
-}
-
-enum EnumRoleLevel {
-  Organization
-  Project
-}
-
```


